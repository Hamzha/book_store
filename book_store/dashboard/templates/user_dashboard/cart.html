{% extends 'user_dashboard/base.html' %}
{% load static %}
{% load filters_user %}
{% block navbar_address %}
<li class="breadcrumb-item active">Cart</li>


{% endblock navbar_address %}
{% block content %}
<main class="cart-page-main-block inner-page-sec-padding-bottom">
    <div class="cart_area cart-area-padding  ">
        <div class="container">
            <div class="page-section-title">
                <h1>Shopping Cart</h1>
            </div>
            <div class="row">
                <div class="col-12">
                    <form action="#" class="">
                        <!-- Cart Table -->
                        <div class="cart-table table-responsive mb--40">
                            <table class="table">
                                <!-- Head Row -->
                                <thead>
                                <tr>
                                    <!--                                    <th class="pro-remove"></th>-->
                                    <th class="pro-thumbnail">Cover Photo</th>
                                    <th class="pro-title"> Book Author</th>
                                    <th class="pro-title">Book Title</th>
                                    <th class="pro-price">Price</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Product Row -->
                                {% for book in books %}
                                <tr>
                                    <!--                                    <td class="pro-remove"><a href="#"><i class="far fa-trash-alt"></i></a>-->
                                    </td>
                                    <td class="pro-thumbnail"><img
                                            src="{{ book.cover_photo.url }}" style="height: 150px; width: 120px"
                                            alt="Product"></td>
                                    <td class="pro-title">{{book.author}}</td>

                                    <td class="pro-title">{{book.title}}</td>
                                    <td class="pro-price">
                                        {% if book.percentage %}
                                        <del class="price-old">Rs. {{book.price}}</del>
                                        <span>Rs. {{ book.price|calculate_price:book.percentage}}</span>
                                        {% else %}
                                        <span>Rs. {{book.price}}</span>
                                        {% endif %}
                                    </td>

                                </tr>

                                {% endfor %}
                                <tr>
                                    <td colspan="6" class="actions">
                                        <div class="coupon-block">
                                            <div class="coupon-text">
                                                <label for="coupon_code">Coupon:</label>
                                                <input type="text" name="coupon_code" class="input-text"
                                                       id="coupon_code" value="" placeholder="Coupon code">
                                            </div>
                                            <div class="coupon-btn">
                                                <input  class="btn btn-outlined"
                                                       name="apply_coupon" id="apply_coupon"  value="Apply coupon">
                                            </div>
                                        </div>

                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="cart-section-2">
        <div class="container">
            <div class="row">

            </div>
            <!-- Cart Summary -->
            <div class="col-lg-12 col-12 d-flex">
                <div class="cart-summary">
                    <div class="cart-summary-wrap">
                        <h4><span>Cart Summary</span></h4>

                        <h2>Total <span class="text-primary">&nbsp; PKR</span> <span class="text-primary" id="final_total">{{total}}</span></h2>
                    </div>
                    <div class="cart-summary-button">
                        <a href="{% url 'user-cart-payment' %}" class="checkout-btn c-btn btn--primary">Checkout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</main>

<script>
  $(document).ready(function(){
    var voucher = '';

    $('#apply_coupon').click(function(){
       console.log($('#coupon_code').val());
        var obj = new Object();
        obj.code = $('#coupon_code').val();
        obj.csrfmiddlewaretoken = "{{csrf_token}}";
        var jsonString= JSON.stringify(obj);
        $.ajax({
            url: "{% url 'user_check_voucher' %}",
            type: 'get',
            data: {'data' : jsonString},
            success: function(data) {

                if(data['voucher'] != 'None'){
                    voucher = data
                    console.log(voucher['voucher'])
                    pre=parseFloat($('#final_total').text())
                    console.log(voucher['voucher']['credit'])
                    post = pre - voucher['voucher']['credit']
                    console.log(post)
                    $('#final_total').text(parseFloat(post))
                }else{
                    alert('Invalid Code')
                }

            },
            failure: function(data) {}
        });
    });
  });
</script>

{% endblock content %}